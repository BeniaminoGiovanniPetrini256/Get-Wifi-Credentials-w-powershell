$out = "C:\Users\Ben\Desktop\wifi-passwords.txt"
# Start fresh file
"SSID : Password" | Out-File -FilePath $out

# Get profile names
$profiles = (netsh wlan show profiles) -match "All User Profile" | ForEach-Object {
    ($_ -split ":")[1].Trim()
}

# For each profile, get Key Content (password) and append to file
foreach ($p in $profiles) {
    $info = netsh wlan show profile name="$p" key=clear
    $pwdLine = $info | Select-String "Key Content"
    $pwd = if ($pwdLine) { ($pwdLine -split ":")[1].Trim() } else { "<no password or not accessible>" }
    ("{0} : {1}" -f $p, $pwd) | Out-File -FilePath $out -Append
}
